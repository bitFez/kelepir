{% extends 'temel.html' %}
{% load static %}
{% block content %}
<br>

<div class="row">
  {% for kat in katagoriler.all %}
    <a type="button" class="btn-outline-dark btn-lg" href="{% url 'dealcategory' kat.id %}"><i class="{{kat.ikon}}"></i> {{kat.kategori}}</a>
  {% endfor %}
</div>
<br>
<h1>{{h1}}</h1>
<br>


<div class="row">
  <div class="col-sm-9">
      {% for kelepir in kelepirler.all %}
        {% if kelepir.aktif == True %}
          <div class="card mb-2" style="max-width: 1000px;">
            <div class="row no-gutters">
              <div class="col-md-3">
                <img src="{{kelepir.goruntu.url}}" style="width: 100%; height: 15vw;" class="card-img image-fluid">
              </div>
              <div class="col-md-9">
                <div class="card-body">
                  <div class="container-fluid">
                  	<div class="row">
                  		<div class="col-md-12">
                  			<div class="row">
                  				<div class="col-md-2">

                              {% if request.user.is_authenticated %}
                                {% if request.user in kelepir.oyveren.all %}
                                <div class="btn-group">
                                  <button class="btn btn-secondary" disabled><i class="fas fa-minus"></i></button>
                                  <span class="btn btn" id="puanlar" disabled>{{kelepir.derece}}°</span>
                                  <button class="btn btn btn-secondary"disabled><i class="fas fa-plus"></i></button>
                                </div>
                                {% else %}
                                <div class="btn-group">
                                  <button class="btn btn-danger" id="downvote_button" value="{{kelepir.id}}"><i class="fas fa-minus"></i></button>
                                  <span class="btn btn" id="puanlar" disabled>{{kelepir.derece}}°</span>
                                  <button class="btn btn-success" id="upvote_button" value="{{kelepir.id}}"><i class="fas fa-plus" ></i></button>
                                </div>
                                {% endif %}
                              {% else %}
                              <div class="btn-group">
                                <a href="{% url 'login' %}" class="btn btn-danger"><i class="fas fa-minus"></i></a>
                                <span class="btn btn" id="puanlar" disabled>{{kelepir.derece}}°</span>
                                <a href="{% url 'login' %}" class="btn btn-success"><i class="fas fa-plus"></i></a>
                              </div>
                              {% endif %}


                  				</div>
                  				<div class="col-md-5">
                  				</div>
                  				<div class="col-md-3">
                            <small class="text-muted">{% if kelepir.son_tarih %}<i class="far fa-calendar-alt"></i><br>{{ kelepir.son_tarih }}'de kelepir tükenir{% endif %}</small>
                  				</div>
                  				<div class="col-md-2">
                            <small class="text-muted"><i class="fas fa-bullhorn"></i><br>{{kelepir.duyurmaTarihi|timesince}}</small>
                  				</div>
                  			</div>
                  		</div>
                  	</div>
                  </div>
                  <br>
                  <h5 class="card-title"> <a href="{% url 'madde_detay' kelepir.id %}">{{kelepir.baslik}}</h5></a>
                  <p><span style="color:Tomato;"><b>{{kelepir.fiyat}}₺</b></span>  {{orjinalFiyat}}</p>
                  <p class="card-text">{{kelepir.ayrintilar|truncatewords:30}}...
                    <a href="{% url 'madde_detay' kelepir.id %}"><strong>devamını oku</strong></p></a>

                  <div class="d-flex bd-highlight">

                  		<div class="flex-grow-1 bd-highlight">
                        <p class="card-text"><strong> <a href="{% url 'profil_detay' kelepir.paylasan.id %}">{{kelepir.paylasan}}</a></strong></p>
                  		</div>

                      <div class="p-2 bd-highlight">
                        {% if request.user.is_authenticated %}
                            {% if request.user in kelepir.bookmarked.all %}
                              <a href="{% url 'bookmark' kelepir.id %}" type="button" class="btn btn-outline-dark btn-lg"><i class="fas fa-bookmark"></i></a>
                            {% else %}
                              <a href="{% url 'bookmark' kelepir.id %}" type="button" class="btn btn-outline-dark btn-lg"><i class="far fa-bookmark"></i></a>
                            {% endif %}
                        {% else %}
                          <a href="{% url 'login' %}" type="button" class="btn btn-outline-dark btn-lg"><i class="far fa-bookmark"></i></a>
                        {% endif %}
                  		</div>
                  		<div class="p-2 bd-highlight">
                        <a href="" type="button" class="btn btn-outline-dark"><i class="fas fa-comments"></i> {{kelepir.comments.count}}</a>
                  		</div>
                  		<div class="p-2 bd-highlight">
                        <a href="{{kelepir.url}}" type="button" class="btn btn-danger">Fırsatı Kap <i class="fas fa-external-link-alt"></i></a>
                  		</div>

                  </div>

                </div>
              </div>
            </div>
          </div>
        {% else %}
        <div class="card mb-2 bg-light border-light" style="max-width: 1000px;">
            <div class="row no-gutters">
              <div class="col-md-3">
                <img src="{{kelepir.goruntu.url}}" style="width: 100%; height: 15vw; opacity: 0.5" class="card-img image-fluid">
              </div>
              <div class="col-md-9">
                <div class="card-body text-secondary">
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-md-12">
                        <div class="row">
                          <div class="col-md-5">
                            <button type="button" class="btn btn-outline-secondary btn" disabled>{{ kelepir.derece }}° <i class="fas fa-hourglass-end"></i> kelepir tükendi</button>
                          </div>
                          <div class="col-md-5">
                          </div>
                          <div class="col-md-0">
                            <p class=text-muted></p>
                            <p>{% if kelepir.son_tarih %}{{ kelepir.son_tarih }}'de kelepir tükenir{% endif %}</p>
                          </div>
                          <div class="col-md-2">
                            <small class="text-muted"><i class="fas fa-bullhorn"></i><br>{{kelepir.duyurmaTarihi|timesince}}</small>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <br>
                  <h5 class="card-title text-muted"><a class="card-title" href="{% url 'madde_detay' kelepir.id %}" style="color:Grey">{{kelepir.baslik}}</h5></a>
                  <p><span style="color:Grey;"><b>{{kelepir.fiyat}}₺</b></span>  {{orjinalFiyat}}</p>
                  <p class="card-text text-muted">{{kelepir.ayrintilar|truncatewords:30}}...
                    <a href="{% url 'madde_detay' kelepir.id %}" style="color:Grey"><strong>devamını oku</strong></p></a>

                  <div class="d-flex bd-highlight text-muted">

                      <div class="flex-grow-1 bd-highlight text-muted">
                        <p class="card-text"><strong> <a href="{% url 'profil_detay' kelepir.paylasan.id %}">{{kelepir.paylasan}}</a></strong></p>
                      </div>

                      <div class="p-2 bd-highlight">
                        {% if request.user.is_authenticated %}
                            {% if request.user.id in kelepir.bookmarked %}
                              <a href="{% url 'bookmark' kelepir.id %}" type="button" class="btn btn-outline-dark btn-lg"><i class="fas fa-bookmark"></i></a>
                            {% else %}
                              <a href="{% url 'bookmark' kelepir.id %}" type="button" class="btn btn-outline-dark btn-lg"><i class="far fa-bookmark"></i></a>
                            {% endif %}
                        {% else %}
                          <a href="{% url 'login' %}" type="button" class="btn btn-outline-dark btn-lg"><i class="far fa-bookmark"></i></a>
                        {% endif %}
                  		</div>
                      <div class="p-2 bd-highlight">
                        <a href="" type="button" class="btn btn-outline-dark btn-lg"><i class="fas fa-comments"></i></a>
                      </div>
                      <div class="p-2 bd-highlight">
                        <a href="{{kelepir.url}}" type="button" class="btn btn-secondary">Fırsatı Kap <i class="fas fa-external-link-alt"></i></a>
                      </div>

                  </div>

                </div>
              </div>
            </div>
          </div>

        {% endif %}

        {% empty %}
          <div class="card mb-2" style="max-width: 1000px;">
            <h5>Maalesef, {{ request.GET.q }} arayışınızda birşey bulunmadı!</h5>
          </div>
      {% endfor %}
    
  </div>

  <!-- Main page sidebar -->
  <div class="col-sm-3">
    <h5>Haftanın En İyi Kelepirleri</h5>
    <ul class="list-group">
      {% for kelepir in haftanin.all %}
        {% if kelepir.aktif %}
          <li class="list-group-item"><a href="{% url 'madde_detay' kelepir.id %}">{{kelepir.baslik}}</a> - {{kelepir.derece}} puan - {{kelepir.fiyat}}₺</li>
        {% else %}
          <li class="list-group-item" style="color:Grey"><a style="color:Grey" href="{% url 'madde_detay' kelepir.id %}">{{kelepir.baslik}}</a> - {{kelepir.derece}} puan - {{kelepir.fiyat}}₺</li>
        {% endif %}
      {% endfor %}
    </ul>

  </div>
  </div>
      <script type="text/javascript">
      $('#myForm').trigger("reset");

        $(document).on('click', '#upvote_button', function (e) {
          e.preventDefault();
          $.ajax({
            type: 'POST',
            url: '{% url "upvote" %}',
            data: {
              maddeid: $('#upvote_button').val(),
              csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
              action: 'post'
            },
            success: function (json) {
              document.getElementById("puanlar").innerHTML = json['result']
              console.log(json)
            },
            error: function (xhr, errmsg, err) {

            }
          });
        })

      </script>
{% endblock %}
<!-- Photo by <a href="https://www.pexels.com/photo/person-holding-paper-bag-and-face-mask-3987245/">Anna</a> Shvets from Pexels -->
